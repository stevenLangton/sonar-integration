@using JsPlc.Ssc.Link.Models

@{
    ViewBag.Title = "Link conversation";
    var currentUser = TempData["CurrentUser"] as LinkUserView;
    if (currentUser == null)
    {
        Response.Redirect("~/Home/Unauthorized?unauthPage=Link Meeting");
        return;
    }
}

<div class="myPageContainer">
    <div id="linkpage" style="display: none;" data-bind="visible: true">
        <div id="breadcrumbs">@Html.MvcSiteMap().SiteMapPath()</div>
        <!-- knockout binding to this -->
        <div id="msgs"></div>
        <div style="display: none;" data-bind="visible: !$root.dataAvailable()">
            <h2 style="color: red">Cannot retrieve meeting. Invalid access or meeting might have completed.</h2>
        </div>
        <form id="myform" method="post" style="display: none;" data-bind="submit: saveLinkForm, visible: $root.dataAvailable">
            <div class="row">
                <div class="col-md-12">
                    <div class="content-inline heading-withdatepicker">
                        <h2>@ViewBag.Title</h2>
                    </div>

                    <!-- Meeting Date -->
                    <div class="content-inline">
                        <input type="text" id="MeetingDate" data-bind="value: dataModel().MeetingDate" class="datepicker form-control xcontent-inline"
                               readonly name="MeetingDate" style="width:100px" />
                    </div>
                    <div class="content-inline text-between-pickers">
                        <span>&nbsp;at&nbsp;</span>
                    </div>
                    <div class="content-inline">
                        <div class="input-group bootstrap-timepicker timepicker" style="width: 130px">
                            <input id="timepicker1" type="text" class="form-control input-small" data-bind="value: dataModel().MeetingTime">
                            <span class="input-group-addon"><i class="glyphicon glyphicon-time"></i></span>
                        </div>
                    </div>
                </div>
            </div>
            <br />
            <div class="meeting-banner">
                <div class="col-xs-6 col-md-1"><img src="/Content/Images/default_profile_picture.png" alt="..." class="img-circle" width="30"> </div>
                <div class="col-xs-6 col-md-11 left"><span class="colleagueInfo" data-bind="text: $root.dataModel().ColleagueName"></span></div>
                <br style="clear:both;">
            </div>
            <!-- Columns are always 50% wide, on mobile and desktop -->
            <div data-bind="with: dataModel">
                <!--Looking Back -->

                <h3 class="linksection-heading">LOOKING BACK</h3>
                <!-- LinkForm data items here -->
                <!-- QUESTIONS Loop around this -->
                <div data-bind="foreach: LookingBackQuestions">

                    <h3 data-bind="text: Question , 'name': 'Question[' + QuestionId + '].Question'"></h3>
                    @*<div style="text-align:right;margin-top:-20px;">Discussed? <input type="checkbox" data-bind="checked: Discussed" /></div>*@

                    <!-- no collapse/expansion - always visible -->
                    <div class="row">
                        <div class="col-xs-12 comments-container">
                            @*<span>Comment:</span><br />*@
                            <textarea data-bind="text: ColleagueComment, value:ColleagueComment, enable: $parent.ColleagueId=='@currentUser.Colleague.ColleagueId'"
                                      rows="2" id="ques1text" placeholder="Enter comments here (max 5000 chars)" maxlength="5000"></textarea><br />
                            <!-- xevent: {keyup: UpdCharCount('#ques1text', '#ques1chars'), keypress: UpdCharCount('#ques1text', '#ques1chars'), paste: UpdCharCount('#ques1text', '#ques1chars')} -->
                            @*<span id="ques1chars"></span>*@
                        </div>
                    </div>
                </div>


                <!-- Looking Forward -->
                <h3 class="linksection-heading">LOOKING FORWARD</h3>

                <!-- QUESTIONS Loop around this -->
                <div data-bind="foreach: LookingFwdQuestions">

                    <h3 data-bind="text: Question , 'name': 'Question[' + QuestionId + '].Question'"></h3>

                    <div class="row">
                        <div class="col-xs-12 comments-container">
                            @*<span>Colleague Comment:</span><br />*@
                            <textarea data-bind="text: ColleagueComment, value:ColleagueComment, enable: $parent.ColleagueId=='@currentUser.Colleague.ColleagueId', attr: {maxlength:$index()==2?'400':'5000', placeholder: $index()==2?'Enter comments here (max 400 chars)':'Enter comments here (max 5000 chars)' }"
                                      rows="2" maxlength="5000"></textarea>
                        </div>
                    </div>
                </div>


                <!--  DRIVING MY DEVELOPMENT -->
                <h3 class="linksection-heading">DRIVING MY DEVELOPMENT</h3>

                <!-- QUESTIONS Loop around this -->
                <div data-bind="foreach: DrivingDevelopmentQuestions">

                    <h3 data-bind="text: Question , 'name': 'Question[' + QuestionId + '].Question'"></h3>

                    <div class="row">
                        <div class="col-xs-12 comments-container">
                            @*<span>Colleague Comment:</span><br />*@
                            <textarea data-bind="text: ColleagueComment, value:ColleagueComment, enable: $parent.ColleagueId=='@currentUser.Colleague.ColleagueId', attr: {maxlength:$index()==2?'400':'5000', placeholder: $index()==2?'Enter colleague here (max 400 chars)':'Enter comments here (max 5000 chars)' }"
                                      rows="2" maxlength="5000"></textarea>
                        </div>
                    </div>
                </div>


                <!--  IN A IN A NUTSHELL -->
                <h3 class="linksection-heading">IN A NUTSHELL</h3>
                <!-- QUESTIONS Loop around this -->
                <div data-bind="foreach: InANutShellQuestions">

                    <h3 data-bind="text: Question , 'name': 'Question[' + QuestionId + '].Question'"></h3>
                    @*<div style="text-align:right;margin-top:-20px;">Discussed? <input type="checkbox" data-bind="checked: Discussed" /></div>*@

                    <div class="row">
                        <div class="col-xs-12 comments-container">
                            @*<span>Colleague Comment:</span><br />*@
                            <textarea data-bind="text: ColleagueComment, value:ColleagueComment, enable: $parent.ColleagueId=='@currentUser.Colleague.ColleagueId', attr: {maxlength:$index()==2?'400':'5000', placeholder: $index()==2?'Enter comments here (max 400 chars)':'Enter comments here (max 5000 chars)' }"
                                      rows="2" maxlength="5000"></textarea>
                        </div>
                    </div>
                </div>

            </div>
            <br />
            <div class="alert alert-info col-xs-12" style="text-align: right; background-color: whitesmoke">
                <div class="col-xs-12">
                    <!-- ColleagueInitiated means: If ColleagueId param is same as LoggedInUser.Colleague.ColleagueId
                            then this meeting is being viewed by Colleague,
                            else it is being viewed by manager
                            -> This check is done in controller itself
                            -->
                    @*<-- Manager view: Signoff section.. (only show "Approved" box once colleague has done Signoff) -->*@
                    <div style="display: none" data-bind="visible: (!dataModel().ColleagueInitiated && dataModel().ColleagueSignOff==1)">
                        <strong>Approved:</strong>
                        &nbsp;&nbsp;<input id="Checkbox1" type="checkbox" class="pointable"
                                           data-bind="attr: {NOTBOUNDchecked: dataModel().ManagerSignOff},
                                                      value: dataModel().ManagerSignOff,
                                                      enable: !(dataModel().ColleagueInitiated),
                                                      readonly: (dataModel().ColleagueInitiated),
                                                      click: $root.confirmCheckbox" name="Completed1" /><br />

                    </div>
                    @*<-- Colleague view: Signoff section.. -->*@
                    <div style="display: none" data-bind="visible: (dataModel().ColleagueInitiated)">
                        <strong>Meeting complete:</strong>
                        <input id="Checkbox2" type="checkbox" class="pointable"
                               data-bind="checked: dataModel().ColleagueSignOff, value: dataModel().ColleagueSignOff, enable: (dataModel().ColleagueInitiated), readonly: !(dataModel().ColleagueInitiated),
                                                      click: $root.confirmCheckbox" name="Completed2" />
                    </div>

                    <!-- Show signoff dates -->
                    <div data-bind="visible: (dataModel().ColleagueSignOff==0)">
                        <span data-bind="text: (dataModel().ColleagueInitiated) ? 'You have ' : (dataModel().ColleagueName + ' has ')"></span>
                        not yet submitted this Link meeting.
                    </div>
                    <div data-bind="visible: (dataModel().ColleagueSignOff==1)">
                        <span data-bind="text: (dataModel().ColleagueInitiated) ? 'You' : dataModel().ColleagueName "></span>
                        submitted this Link meeting on
                        <span style="font-family:'Arial Bold', 'Arial';font-weight:500;font-size:15px;"
                              data-bind="text: $root.formatDateMonthDYHM($root.dataModel().ColleagueSignedOffDate) "></span>

                        <div data-bind="visible: (dataModel().ManagerSignOff ==0)">
                            <span data-bind="text: (dataModel().ColleagueInitiated) ? (dataModel().ManagerName + ' has ') : 'You have ' "></span>
                            not yet approved this Link meeting
                        </div>
                        <div data-bind="visible: (dataModel().ManagerSignOff ==1)">
                            <span data-bind="text: (dataModel().ColleagueInitiated) ? dataModel().ManagerName : 'You ' "></span>
                            approved this Link meeting on
                            <span style="font-family:'Arial Bold', 'Arial';font-weight:500;font-size:15px;"
                                  data-bind="text: $root.formatDateMonthDYHM($root.dataModel().ManagerSignedOffDate) "></span>
                        </div>
                    </div>

                    <br />
                    <div class="right">
                        <button type="button" class="btn btn-default" data-bind="visible: $root.dataAvailable, click: saveLinkForm">Save Changes</button>
                        &nbsp; &nbsp;
                    </div>
                    @*<a class="btn btn-default" data-bind="click: $root.downloadLinkFormAsPdf">Download</a>*@
                </div>
            </div>
        </form>

    </div><!-- end ko linkpage -->
</div>
<script type="text/javascript">
    require(["LinkFormCreate"]);
</script>

